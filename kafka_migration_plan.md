# üöÄ –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Apache Kafka

## üìã –û–±–∑–æ—Ä –º–∏–≥—Ä–∞—Ü–∏–∏

### –¶–µ–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ **–£—Å–∫–æ—Ä–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏** –∑–∞–∫–∞–∑–æ–≤ –≤ 3-5 —Ä–∞–∑
- ‚úÖ **–£–ª—É—á—à–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏** - –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ **–ü–æ–≤—ã—à–µ–Ω–∏–µ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏** - –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤** - –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- ‚úÖ **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö** - —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

### –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- üêå –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∏–∫–æ–≤—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫
- üîó –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
- üí• –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–±–æ—è—Ö
- üìà –°–ª–æ–∂–Ω–æ—Å—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
- üîç –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

## üóìÔ∏è –≠—Ç–∞–ø—ã –º–∏–≥—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (1-2 –Ω–µ–¥–µ–ª–∏)

#### 1.1 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Kafka –∫–ª–∞—Å—Ç–µ—Ä–∞
```bash
# –ó–∞–ø—É—Å–∫ Kafka –∫–ª–∞—Å—Ç–µ—Ä–∞
./start_kafka_cluster.sh

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤
./create_topics.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
./health_check.sh
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ì–æ—Ç–æ–≤—ã–π –∫ —Ä–∞–±–æ—Ç–µ Kafka –∫–ª–∞—Å—Ç–µ—Ä —Å 3 –Ω–æ–¥–∞–º–∏

#### 1.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Kafka UI –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Prometheus + Grafana –¥–ª—è –º–µ—Ç—Ä–∏–∫
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–ª–∞—Å—Ç–µ—Ä–∞

#### 1.3 –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤
- `KafkaConfig` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `BaseEvent` - –±–∞–∑–æ–≤—ã–µ —Å—Ö–µ–º—ã —Å–æ–±—ã—Ç–∏–π
- `KafkaEventProducer` - producer
- `KafkaEventConsumer` - consumer

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ì–æ—Ç–æ–≤–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Kafka

### –≠—Ç–∞–ø 2: –ü–∏–ª–æ—Ç–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ (2-3 –Ω–µ–¥–µ–ª–∏)

#### 2.1 –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–æ–∫
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è

**–¢–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å:**
```python
# –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å
def create_request(data):
    request = save_to_db(data)  # –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –≤—ã–∑–æ–≤
    send_email_notification()   # –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –≤—ã–∑–æ–≤
    notify_managers()          # –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –≤—ã–∑–æ–≤
    return request
```

**–ù–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å:**
```python
# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å
def create_request(data):
    request = save_to_db(data)  # –¢–æ–ª—å–∫–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
    
    # –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è
    event = RequestCreatedEvent(
        request_id=request.id,
        customer_id=request.customer_id,
        # ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
    )
    kafka_producer.publish_event("request-events", event)
    
    return request  # –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**
1. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è `CreateRequestPage.tsx` - —É–±—Ä–∞—Ç—å –æ–∂–∏–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `RequestWorkflowService.create_request()`
3. –°–æ–∑–¥–∞–Ω–∏–µ `NotificationServiceConsumer` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- Unit —Ç–µ—Å—Ç—ã –¥–ª—è producer/consumer
- Integration —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º Kafka
- Load —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### 2.2 –ú–∏–≥—Ä–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è

**–¢–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å:**
```python
# –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
def assign_contractor(request_id, contractor_id):
    update_request_status(request_id, "assigned")
    send_telegram_notification(contractor_id)  # –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π
    send_email_to_customer()                   # –ë–ª–æ–∫–∏—Ä—É—é—â–∏–π
```

**–ù–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å:**
```python
# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
def assign_contractor(request_id, contractor_id):
    update_request_status(request_id, "assigned")
    
    # –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è
    event = WorkflowContractorAssignedEvent(
        request_id=request_id,
        contractor_id=contractor_id,
        # ...
    )
    kafka_producer.publish_event("workflow-events", event)
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**
1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `RequestWorkflowService.assign_contractor()`
2. –°–æ–∑–¥–∞–Ω–∏–µ `TelegramNotificationConsumer`
3. –°–æ–∑–¥–∞–Ω–∏–µ `EmailNotificationConsumer`

### –≠—Ç–∞–ø 3: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ (3-4 –Ω–µ–¥–µ–ª–∏)

#### 3.1 –ú–∏–≥—Ä–∞—Ü–∏—è workflow –∑–∞—è–≤–æ–∫
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è

**–°–æ–±—ã—Ç–∏—è –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏:**
- `workflow.manager_assigned`
- `workflow.sent_to_contractors`
- `workflow.work_started`
- `workflow.work_completed`
- `workflow.status_changed`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**
1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ –≤ `RequestWorkflowService`
2. –°–æ–∑–¥–∞–Ω–∏–µ `WorkflowEventConsumer`
3. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è `ManagerWorkflowPage.tsx`

#### 3.2 –ú–∏–≥—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è

**–°–æ–±—ã—Ç–∏—è –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏:**
- `security.contractor_verified`
- `security.contractor_rejected`
- `security.access_granted`
- `security.access_revoked`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**
1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `SecurityVerificationService`
2. –°–æ–∑–¥–∞–Ω–∏–µ `SecurityEventConsumer`
3. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è `SecurityVerificationPage.tsx`

#### 3.3 –ú–∏–≥—Ä–∞—Ü–∏—è HR —Å–∏—Å—Ç–µ–º—ã
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è

**–°–æ–±—ã—Ç–∏—è –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏:**
- `hr.document_created`
- `hr.document_signed`
- `hr.contract_generated`
- `hr.payment_processed`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**
1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `HRDocumentService`
2. –°–æ–∑–¥–∞–Ω–∏–µ `HREventConsumer`
3. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è `HRDocumentsPage.tsx`

### –≠—Ç–∞–ø 4: –ê—É–¥–∏—Ç –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (2-3 –Ω–µ–¥–µ–ª–∏)

#### 4.1 –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∞—É–¥–∏—Ç–∞
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è

**–°–æ–±—ã—Ç–∏—è –¥–ª—è –∞—É–¥–∏—Ç–∞:**
- `audit.user_action`
- `audit.system_event`
- `audit.error_occurred`
- `audit.performance_metric`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**
1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞—É–¥–∏—Ç–∞ –≤–æ –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
2. –°–æ–∑–¥–∞–Ω–∏–µ `AuditEventConsumer`
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ClickHouse –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

#### 4.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ClickHouse
- –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–æ–≤ –≤ Grafana
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤

### –≠—Ç–∞–ø 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (1-2 –Ω–µ–¥–µ–ª–∏)

#### 5.1 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∂–∞—Ç–∏—è

#### 5.2 –ü–æ–ª–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫
- –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤

## üîÑ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

### Dual-Write –ø–æ–¥—Ö–æ–¥
```python
class RequestServiceMigration:
    def create_request(self, data):
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î (–∫–∞–∫ —Ä–∞–Ω—å—à–µ)
        request = self._save_to_db(data)
        
        # –ü—É–±–ª–∏–∫—É–µ–º —Å–æ–±—ã—Ç–∏–µ (–Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)
        try:
            event = RequestCreatedEvent(
                request_id=request.id,
                customer_id=request.customer_id,
                # ...
            )
            kafka_producer.publish_event("request-events", event)
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏—è: {e}")
            # –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å
        
        return request
```

### –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
1. **–§–∞–∑–∞ 1:** Dual-write (—Å—Ç–∞—Ä–∞—è + –Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞)
2. **–§–∞–∑–∞ 2:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏
3. **–§–∞–∑–∞ 3:** –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É
4. **–§–∞–∑–∞ 4:** –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–∏

### Rollback –ø–ª–∞–Ω
```python
class RollbackManager:
    def rollback_to_sync(self):
        """–û—Ç–∫–∞—Ç –∫ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ"""
        # –û—Ç–∫–ª—é—á–∞–µ–º Kafka consumers
        # –í–∫–ª—é—á–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã
        # –õ–æ–≥–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
    
    def process_pending_events(self):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∫–æ–ø–∏–≤—à–∏—Ö—Å—è —Å–æ–±—ã—Ç–∏–π"""
        # –ß–∏—Ç–∞–µ–º —Å–æ–±—ã—Ç–∏—è –∏–∑ Kafka
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
        # –£–¥–∞–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ API:** < 200ms (–±—ã–ª–æ 2-5s)
- **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:** 1000+ –∑–∞—è–≤–æ–∫/–º–∏–Ω (–±—ã–ª–æ 100-200)
- **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–∫–∏:** < 30s (–±—ã–ª–æ 2-5 –º–∏–Ω)

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- **–î–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π:** 99.99%
- **–ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö:** 0%
- **–í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:** < 30s

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:** +300% –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–ü–∏–∫–æ–≤—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏:** –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏
- **–†–µ—Å—É—Ä—Å—ã:** —Å–Ω–∏–∂–µ–Ω–∏–µ CPU –Ω–∞ 40%

## üß™ –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### Unit —Ç–µ—Å—Ç—ã
```python
def test_request_created_event():
    """–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è –∑–∞—è–≤–∫–∏"""
    event = RequestCreatedEvent(
        request_id=123,
        customer_id=456,
        title="Test Request"
    )
    
    assert event.event_type == EventType.REQUEST_CREATED
    assert event.request_id == 123
    assert event.customer_id == 456

def test_kafka_producer():
    """–¢–µ—Å—Ç Kafka producer"""
    producer = KafkaEventProducer()
    event = RequestCreatedEvent(request_id=123, customer_id=456, title="Test")
    
    success = producer.publish_event("request-events", event)
    assert success == True
```

### Integration —Ç–µ—Å—Ç—ã
```python
def test_end_to_end_request_flow():
    """–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏"""
    # 1. –°–æ–∑–¥–∞–µ–º –∑–∞—è–≤–∫—É
    response = client.post("/api/v1/requests", json=request_data)
    assert response.status_code == 201
    
    # 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–±—ã—Ç–∏–µ –≤ Kafka
    consumer = KafkaEventConsumer(["request-events"])
    messages = consumer.poll(timeout_ms=5000)
    assert len(messages) > 0
    
    # 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º email
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram
```

### Load —Ç–µ—Å—Ç—ã
```python
def test_high_load():
    """–¢–µ—Å—Ç –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏"""
    # –°–æ–∑–¥–∞–µ–º 1000 –∑–∞—è–≤–æ–∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
    tasks = []
    for i in range(1000):
        task = asyncio.create_task(create_request_async(request_data))
        tasks.append(task)
    
    results = await asyncio.gather(*tasks)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –∑–∞—è–≤–∫–∏ —Å–æ–∑–¥–∞–Ω—ã
    assert len(results) == 1000
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    assert all(r.status_code == 201 for r in results)
```

### Chaos —Ç–µ—Å—Ç—ã
```python
def test_kafka_broker_failure():
    """–¢–µ—Å—Ç –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –ø—Ä–∏ —Å–±–æ–µ –±—Ä–æ–∫–µ—Ä–∞"""
    # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–¥–∏–Ω –±—Ä–æ–∫–µ—Ä
    docker.stop("kafka-2")
    
    # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É
    response = client.post("/api/v1/requests", json=request_data)
    assert response.status_code == 201
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±—Ä–æ–∫–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ
    docker.start("kafka-2")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ–±—ã—Ç–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
    # –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
```

## üö® –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏

#### 1. –ü–æ—Ç–µ—Ä—è —Å–æ–æ–±—â–µ–Ω–∏–π
**–†–∏—Å–∫:** –í—ã—Å–æ–∫–∏–π
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `acks=all`
- –í–∫–ª—é—á–µ–Ω–∏–µ retry –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Dead Letter Queues
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ consumer lag

#### 2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å Kafka
**–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∂–∞—Ç–∏—è
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫

#### 3. –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏
**–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π
- Kafka UI –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### –ë–∏–∑–Ω–µ—Å —Ä–∏—Å–∫–∏

#### 1. –ü—Ä–æ—Å—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã
**–†–∏—Å–∫:** –í—ã—Å–æ–∫–∏–π
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –ü–æ—ç—Ç–∞–ø–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
- Dual-write –ø–æ–¥—Ö–æ–¥
- Rollback –ø–ª–∞–Ω
- –¢—â–∞—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 2. –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö
**–†–∏—Å–∫:** –í—ã—Å–æ–∫–∏–π
**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- –†–µ–ø–ª–∏–∫–∞—Ü–∏—è factor=3
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π
- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

## üìÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–º–∫–∏

| –≠—Ç–∞–ø | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ö–æ–º–∞–Ω–¥–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|------|-------------|---------|-----------|
| 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã | 1-2 –Ω–µ–¥–µ–ª–∏ | DevOps + Backend | Kafka –∫–ª–∞—Å—Ç–µ—Ä |
| 2. –ü–∏–ª–æ—Ç–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ | 2-3 –Ω–µ–¥–µ–ª–∏ | Backend + Frontend | –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫ |
| 3. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ | 3-4 –Ω–µ–¥–µ–ª–∏ | Backend + Frontend | –ü–æ–ª–Ω—ã–π workflow |
| 4. –ê—É–¥–∏—Ç –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ | 2-3 –Ω–µ–¥–µ–ª–∏ | Backend + DevOps | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |
| 5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è | 1-2 –Ω–µ–¥–µ–ª–∏ | Backend + DevOps | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 9-14 –Ω–µ–¥–µ–ª—å
**–ö–æ–º–∞–Ω–¥–∞:** 4-6 —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

## üí∞ –ë—é–¥–∂–µ—Ç

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **Kafka –∫–ª–∞—Å—Ç–µ—Ä:** $500-1000/–º–µ—Å—è—Ü
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** $200-400/–º–µ—Å—è—Ü
- **–•—Ä–∞–Ω–∏–ª–∏—â–µ:** $100-200/–º–µ—Å—è—Ü

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- **Backend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏:** 2-3 —á–µ–ª–æ–≤–µ–∫–∞ √ó 3 –º–µ—Å—è—Ü–∞
- **Frontend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏:** 1-2 —á–µ–ª–æ–≤–µ–∫–∞ √ó 2 –º–µ—Å—è—Ü–∞
- **DevOps –∏–Ω–∂–µ–Ω–µ—Ä:** 1 —á–µ–ª–æ–≤–µ–∫ √ó 2 –º–µ—Å—è—Ü–∞

### –û–±—É—á–µ–Ω–∏–µ
- **Kafka –æ–±—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã:** $2000-5000
- **–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤:** $5000-10000

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏
- [ ] Kafka –∫–ª–∞—Å—Ç–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- [ ] –í—Å–µ —Ç–æ–ø–∏–∫–∏ —Å–æ–∑–¥–∞–Ω—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Unit —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç 90% –∫–æ–¥–∞
- [ ] Integration —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] Load —Ç–µ—Å—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç—Ä–µ–±—É–µ–º—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ë–∏–∑–Ω–µ—Å –∫—Ä–∏—Ç–µ—Ä–∏–∏
- [ ] –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ API < 200ms
- [ ] –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å > 1000 –∑–∞—è–≤–æ–∫/–º–∏–Ω
- [ ] –î–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π > 99.9%
- [ ] –ö–æ–º–∞–Ω–¥–∞ –æ–±—É—á–µ–Ω–∞ —Ä–∞–±–æ—Ç–µ —Å Kafka
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [ ] Rollback –ø–ª–∞–Ω –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞–Ω–∞** —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º
2. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã** –ø—Ä–æ–µ–∫—Ç–∞
3. **–ó–∞–∫–∞–∑ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã** –¥–ª—è Kafka
4. **–ù–∞—á–∞–ª–æ –≠—Ç–∞–ø–∞ 1** - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
5. **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ —Ä–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤—ã** –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–ª–∞–Ω–∞

